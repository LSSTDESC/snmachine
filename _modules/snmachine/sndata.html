

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>snmachine.sndata &mdash; snmachine 1.0.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> snmachine
          

          
          </a>

          
            
            
              <div class="version">
                1.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation and Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../parallel.html">Running on Clusters / in Parallel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../API.html">API</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">snmachine</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>snmachine.sndata</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for snmachine.sndata</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module containing Dataset classes. These read in data from various sources and turns the light curves into astropy tables that</span>
<span class="sd">can be read by the rest of the code.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span>
<span class="kn">from</span> <span class="nn">past.builtins</span> <span class="k">import</span> <span class="n">basestring</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;DISPLAY&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">matplotlib</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;Agg&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">astropy.table</span> <span class="k">import</span> <span class="n">Table</span><span class="p">,</span> <span class="n">Column</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="k">import</span> <span class="n">fits</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">sncosmo</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="k">import</span> <span class="n">shuffle</span><span class="p">,</span><span class="n">sample</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">interpolate</span>
<span class="kn">import</span> <span class="nn">sncosmo</span><span class="o">,</span> <span class="nn">math</span>

<span class="c1">#Colours for graphs</span>
<span class="n">colours</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;sdssu&#39;</span><span class="p">:</span><span class="s1">&#39;#6614de&#39;</span><span class="p">,</span><span class="s1">&#39;sdssg&#39;</span><span class="p">:</span><span class="s1">&#39;#007718&#39;</span><span class="p">,</span><span class="s1">&#39;sdssr&#39;</span><span class="p">:</span><span class="s1">&#39;#b30100&#39;</span><span class="p">,</span><span class="s1">&#39;sdssi&#39;</span><span class="p">:</span><span class="s1">&#39;#d35c00&#39;</span><span class="p">,</span><span class="s1">&#39;sdssz&#39;</span><span class="p">:</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="s1">&#39;desg&#39;</span><span class="p">:</span><span class="s1">&#39;#007718&#39;</span><span class="p">,</span><span class="s1">&#39;desr&#39;</span><span class="p">:</span><span class="s1">&#39;#b30100&#39;</span><span class="p">,</span><span class="s1">&#39;desi&#39;</span><span class="p">:</span><span class="s1">&#39;#d35c00&#39;</span><span class="p">,</span><span class="s1">&#39;desz&#39;</span><span class="p">:</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
            <span class="s1">&#39;lssty&#39;</span><span class="p">:</span><span class="s1">&#39;#2727c1&#39;</span><span class="p">,</span><span class="s1">&#39;lsstu&#39;</span><span class="p">:</span><span class="s1">&#39;#6614de&#39;</span><span class="p">,</span><span class="s1">&#39;lsstg&#39;</span><span class="p">:</span><span class="s1">&#39;#007718&#39;</span><span class="p">,</span><span class="s1">&#39;lsstr&#39;</span><span class="p">:</span><span class="s1">&#39;#b30100&#39;</span><span class="p">,</span><span class="s1">&#39;lssti&#39;</span><span class="p">:</span><span class="s1">&#39;#d35c00&#39;</span><span class="p">,</span><span class="s1">&#39;lsstz&#39;</span><span class="p">:</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="s1">&#39;lsstY&#39;</span><span class="p">:</span><span class="s1">&#39;#2727c1&#39;</span><span class="p">}</span>
<span class="n">sntypes</span><span class="o">=</span><span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="s1">&#39;Ia&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="s1">&#39;II&#39;</span><span class="p">,</span><span class="mi">21</span><span class="p">:</span><span class="s1">&#39;IIn&#39;</span><span class="p">,</span><span class="mi">22</span><span class="p">:</span><span class="s1">&#39;IIP&#39;</span><span class="p">,</span><span class="mi">23</span><span class="p">:</span><span class="s1">&#39;IIL&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="s1">&#39;Ibc&#39;</span><span class="p">,</span><span class="mi">32</span><span class="p">:</span><span class="s1">&#39;Ib&#39;</span><span class="p">,</span><span class="mi">33</span><span class="p">:</span><span class="s1">&#39;Ic&#39;</span><span class="p">,</span><span class="mi">66</span><span class="p">:</span><span class="s1">&#39;other&#39;</span><span class="p">}</span>
<span class="n">markers</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;desg&#39;</span><span class="p">:</span><span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="s1">&#39;desr&#39;</span><span class="p">:</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;desi&#39;</span><span class="p">:</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;desz&#39;</span><span class="p">:</span><span class="s1">&#39;*&#39;</span><span class="p">}</span>
<span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;desg&#39;</span><span class="p">:</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;desr&#39;</span><span class="p">:</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;desi&#39;</span><span class="p">:</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;desz&#39;</span><span class="p">:</span><span class="s1">&#39;z&#39;</span><span class="p">}</span>

<div class="viewcode-block" id="plot_lc"><a class="viewcode-back" href="../../API.html#snmachine.sndata.plot_lc">[docs]</a><span class="k">def</span> <span class="nf">plot_lc</span><span class="p">(</span><span class="n">lc</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    External function to plot light curves.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lc : astropy.table.Table</span>
<span class="sd">        Light curve</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        @param fname The filename of the supernova (relative to data_root)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1">#This selects the filters from the possible set that this object has measurements in and maintains the order</span>
    <span class="n">filts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">lc</span><span class="p">[</span><span class="s1">&#39;filter&#39;</span><span class="p">])</span>
    
    <span class="c1">#Keep track of the min and max values on the plot for resizing axes</span>
    <span class="n">min_x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="n">max_x</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="n">lines</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">filts</span><span class="p">)):</span>
        <span class="n">inds</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lc</span><span class="p">[</span><span class="s1">&#39;filter&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">filts</span><span class="p">[</span><span class="n">j</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;flux_error&#39;</span> <span class="ow">in</span> <span class="n">lc</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">t</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">F_err</span><span class="o">=</span><span class="n">lc</span><span class="p">[</span><span class="s1">&#39;mjd&#39;</span><span class="p">][</span><span class="n">inds</span><span class="p">],</span> <span class="n">lc</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">][</span><span class="n">inds</span><span class="p">],</span> <span class="n">lc</span><span class="p">[</span><span class="s1">&#39;flux_error&#39;</span><span class="p">][</span><span class="n">inds</span><span class="p">]</span>
            <span class="n">error</span><span class="o">=</span><span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">t</span><span class="p">,</span> <span class="n">F</span><span class="o">=</span><span class="n">lc</span><span class="p">[</span><span class="s1">&#39;mjd&#39;</span><span class="p">][</span><span class="n">inds</span><span class="p">],</span> <span class="n">lc</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">][</span><span class="n">inds</span><span class="p">]</span>
            <span class="n">error</span><span class="o">=</span><span class="kc">False</span>
        <span class="c1">#tdelt=t-t.min()</span>
        <span class="n">tdelt</span><span class="o">=</span><span class="n">t</span>
        <span class="k">if</span> <span class="n">filts</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">in</span> <span class="n">markers</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">mkr</span><span class="o">=</span><span class="n">markers</span><span class="p">[</span><span class="n">filts</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mkr</span><span class="o">=</span><span class="s1">&#39;o&#39;</span>
        <span class="k">if</span> <span class="n">error</span><span class="p">:</span>
            <span class="n">l</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">tdelt</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">F_err</span><span class="p">,</span>  <span class="n">marker</span><span class="o">=</span><span class="n">mkr</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>  <span class="n">color</span><span class="o">=</span><span class="n">colours</span><span class="p">[</span><span class="n">filts</span><span class="p">[</span><span class="n">j</span><span class="p">]],</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">l</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tdelt</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>  <span class="n">marker</span><span class="o">=</span><span class="n">mkr</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colours</span><span class="p">[</span><span class="n">filts</span><span class="p">[</span><span class="n">j</span><span class="p">]])</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tdelt</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">&lt;</span><span class="n">min_x</span><span class="p">:</span>
            <span class="n">min_x</span><span class="o">=</span><span class="n">tdelt</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">tdelt</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">&gt;</span><span class="n">max_x</span><span class="p">:</span>
            <span class="n">max_x</span><span class="o">=</span><span class="n">tdelt</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            
    
    <span class="n">ext</span><span class="o">=</span><span class="mf">0.05</span><span class="o">*</span><span class="p">(</span><span class="n">max_x</span><span class="o">-</span><span class="n">min_x</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="n">min_x</span><span class="o">-</span><span class="n">ext</span><span class="p">,</span> <span class="n">max_x</span><span class="o">+</span><span class="n">ext</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (days)&#39;</span><span class="p">,</span>  <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Flux&#39;</span><span class="p">,</span>  <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">filts</span><span class="p">,</span> <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Dataset"><a class="viewcode-back" href="../../API.html#snmachine.sndata.Dataset">[docs]</a><span class="k">class</span> <span class="nc">Dataset</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to manage the files from a single dataset. The base class works with data from the SPCC.</span>
<span class="sd">    This class can be inherited and overridden to work a completely different kind of dataset.</span>
<span class="sd">    All this class really needs is a list of object names and a method, get_lightcurve, which takes an individual object name and returns a light curve.</span>
<span class="sd">    Other functions provided here are for plotting and convenience.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>  <span class="n">filter_set</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;desg&#39;</span><span class="p">,</span> <span class="s1">&#39;desr&#39;</span><span class="p">,</span> <span class="s1">&#39;desi&#39;</span><span class="p">,</span> <span class="s1">&#39;desz&#39;</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialisation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        folder : str</span>
<span class="sd">            Root folder containing the data</span>
<span class="sd">        subset : str or list-like, optional</span>
<span class="sd">            Something you pass to get_object_names to specify which objects you want</span>
<span class="sd">        filter_set : list, optional</span>
<span class="sd">            List of possible filters used</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">filter_set</span><span class="o">=</span><span class="n">filter_set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rootdir</span><span class="o">=</span><span class="n">folder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">survey_name</span><span class="o">=</span><span class="n">folder</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">object_names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_object_names</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">subset</span><span class="p">)</span>
        <span class="c1">#Get all the data as a list of astropy tables (this should not be memory intensive, even for large numbers of light curves)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="p">{}</span>
        <span class="n">invalid</span><span class="o">=</span><span class="mi">0</span> <span class="c1">#Some objects may have empty data</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Reading data...&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">object_names</span><span class="p">)):</span>
            <span class="n">lc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_lightcurve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">object_names</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lc</span><span class="p">[</span><span class="s1">&#39;mjd&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">object_names</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">=</span><span class="n">lc</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">invalid</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">invalid</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> objects were invalid and not added to the dataset.&#39;</span> <span class="o">%</span><span class="n">invalid</span><span class="p">)</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> objects read into memory.&#39;</span> <span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
        <span class="c1">#We create an optional model set which can be set by whatever feature class used</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="o">=</span><span class="p">{}</span>
        
<div class="viewcode-block" id="Dataset.get_object_names"><a class="viewcode-back" href="../../API.html#snmachine.sndata.Dataset.get_object_names">[docs]</a>    <span class="k">def</span> <span class="nf">get_object_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets a list of the names of the files within the dataset.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        subset : str or list-like, optional</span>
<span class="sd">            Used to specify which files you want. Current setup is get_object_names will accept a list of</span>
<span class="sd">            indices, a list of actual object names as a subset or the keyword &#39;spectro&#39;.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subset</span><span class="p">,</span><span class="n">basestring</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">subset</span><span class="o">==</span><span class="s1">&#39;spectro&#39;</span><span class="p">:</span>
                <span class="n">object_names</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rootdir</span><span class="o">+</span><span class="s1">&#39;spectro.list&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;U&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">object_names</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rootdir</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">survey_name</span><span class="o">+</span><span class="s1">&#39;.LIST&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;U&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">basestring</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">subset</span><span class="p">):</span>
            <span class="c1">#We assume subset is a list of strings containing object names</span>
            <span class="n">object_names</span><span class="o">=</span> <span class="n">subset</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#Otherwise it must be a list of indices. Otherwise raise an error.</span>
            <span class="n">names</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rootdir</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">survey_name</span><span class="o">+</span><span class="s1">&#39;.LIST&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;U&#39;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">object_names</span><span class="o">=</span> <span class="n">names</span><span class="p">[</span><span class="n">subset</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Invalid subset provided&#39;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
                
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">object_names</span><span class="p">)</span></div>

    
    
<div class="viewcode-block" id="Dataset.get_max_length"><a class="viewcode-back" href="../../API.html#snmachine.sndata.Dataset.get_max_length">[docs]</a>    <span class="k">def</span> <span class="nf">get_max_length</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the length (in days) of the longest observation in the dataset.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">max_obs</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">object_names</span><span class="p">:</span>
            <span class="n">times</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s1">&#39;mjd&#39;</span><span class="p">]</span>
            <span class="n">dif</span><span class="o">=</span><span class="n">times</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">-</span><span class="n">times</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">dif</span><span class="o">&gt;</span><span class="n">max_obs</span><span class="p">:</span>
                <span class="n">max_obs</span><span class="o">=</span><span class="n">dif</span>
        <span class="k">return</span> <span class="n">max_obs</span></div>
    
<div class="viewcode-block" id="Dataset.get_lightcurve"><a class="viewcode-back" href="../../API.html#snmachine.sndata.Dataset.get_lightcurve">[docs]</a>    <span class="k">def</span> <span class="nf">get_lightcurve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a filename, returns a light curve astropy table that conforms with sncosmo requirements</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        flname : str</span>
<span class="sd">            The filename of the supernova (relative to data_root)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        astropy.table.Table</span>
<span class="sd">            Light curve</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fl</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rootdir</span><span class="o">+</span><span class="n">flname</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">mjd</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">flt</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">flux</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">fluxerr</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">z</span><span class="o">=-</span><span class="mi">9</span>
        <span class="n">z_err</span><span class="o">=-</span><span class="mi">9</span>
        <span class="nb">type</span><span class="o">=-</span><span class="mi">9</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fl</span><span class="p">:</span>
            <span class="n">s</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;HOST_GALAXY_PHOTO-Z:&#39;</span><span class="p">:</span>
                    <span class="n">z</span><span class="o">=</span><span class="p">(</span><span class="nb">float</span><span class="p">)(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">z_err</span><span class="o">=</span><span class="p">(</span><span class="nb">float</span><span class="p">)(</span><span class="n">s</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;OBS:&#39;</span><span class="p">:</span>
                    <span class="n">mjd</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">float</span><span class="p">)(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="n">flt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;des&#39;</span><span class="o">+</span><span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                    <span class="n">flux</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">float</span><span class="p">)(</span><span class="n">s</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
                    <span class="n">fluxerr</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">float</span><span class="p">)(</span><span class="n">s</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span>
                <span class="k">elif</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;SIM_COMMENT:&#39;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">sntypes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">sntypes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
                            <span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">)(</span><span class="n">k</span><span class="p">)</span>
                    
        
        <span class="c1">#Zeropoint</span>
        <span class="n">zp</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">27.5</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">mjd</span><span class="p">))</span>
        <span class="n">zpsys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ab&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">mjd</span><span class="p">)</span>
        
        <span class="c1">#Make everything arrays</span>
        <span class="n">mjd</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mjd</span><span class="p">)</span>
        <span class="n">flt</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">flt</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
        <span class="n">flux</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">flux</span><span class="p">)</span>
        <span class="n">fluxerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fluxerr</span><span class="p">)</span>
        <span class="n">start_mjd</span><span class="o">=</span><span class="n">mjd</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">mjd</span><span class="o">=</span><span class="n">mjd</span><span class="o">-</span><span class="n">start_mjd</span> <span class="c1">#We shift the times of the observations to all start at zero. If required, the mjd of the initial observation is stored in the metadata.</span>
        <span class="c1">#Note: obviously this will only zero the observations in one filter band, the others have to be zeroed if fitting functions.</span>
        <span class="n">tab</span> <span class="o">=</span> <span class="n">Table</span><span class="p">([</span><span class="n">mjd</span><span class="p">,</span> <span class="n">flt</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="n">fluxerr</span><span class="p">,</span> <span class="n">zp</span><span class="p">,</span> <span class="n">zpsys</span><span class="p">],</span> <span class="n">names</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;mjd&#39;</span><span class="p">,</span> <span class="s1">&#39;filter&#39;</span><span class="p">,</span> <span class="s1">&#39;flux&#39;</span><span class="p">,</span> <span class="s1">&#39;flux_error&#39;</span><span class="p">,</span> <span class="s1">&#39;zp&#39;</span><span class="p">,</span> <span class="s1">&#39;zpsys&#39;</span><span class="p">),</span> <span class="n">meta</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="n">flname</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">:</span><span class="n">z</span><span class="p">,</span> <span class="s1">&#39;z_err&#39;</span><span class="p">:</span><span class="n">z_err</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="nb">type</span><span class="p">,</span> <span class="s1">&#39;initial_observation_time&#39;</span><span class="p">:</span><span class="n">start_mjd</span><span class="p">})</span>
        
        <span class="k">return</span> <span class="n">tab</span></div>

    
    <span class="k">def</span> <span class="nf">__plot_this</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal function used by other functions to plot light curves.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fname : str</span>
<span class="sd">            The filename of the supernova (relative to data_root)</span>
<span class="sd">        title : str, optional</span>
<span class="sd">            Put a title on the plot</span>
<span class="sd">        loc : str, optional</span>
<span class="sd">            Location of legend</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">lc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">]</span>

        <span class="c1">#This selects the filters from the possible set that this object has measurements in and maintains the order</span>
        <span class="n">filts</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filter_set</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">lc</span><span class="p">[</span><span class="s1">&#39;filter&#39;</span><span class="p">])),</span> <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_set</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        
        <span class="c1">#Keep track of the min and max values on the plot for resizing axes</span>
        <span class="n">min_x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="n">max_x</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="n">lines</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">filts</span><span class="p">)):</span>
            <span class="n">inds</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lc</span><span class="p">[</span><span class="s1">&#39;filter&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">filts</span><span class="p">[</span><span class="n">j</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">t</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">F_err</span><span class="o">=</span><span class="n">lc</span><span class="p">[</span><span class="s1">&#39;mjd&#39;</span><span class="p">][</span><span class="n">inds</span><span class="p">],</span> <span class="n">lc</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">][</span><span class="n">inds</span><span class="p">],</span> <span class="n">lc</span><span class="p">[</span><span class="s1">&#39;flux_error&#39;</span><span class="p">][</span><span class="n">inds</span><span class="p">]</span>
            <span class="c1">#tdelt=t-t.min()</span>
            <span class="n">tdelt</span><span class="o">=</span><span class="n">t</span>
            <span class="k">if</span> <span class="n">filts</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">in</span> <span class="n">markers</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">mkr</span><span class="o">=</span><span class="n">markers</span><span class="p">[</span><span class="n">filts</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mkr</span><span class="o">=</span><span class="s1">&#39;o&#39;</span>
            
            <span class="c1">#Plot the model, if it has been set</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_model</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">fname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">mod</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">fname</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">mod</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">inds</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mod</span><span class="p">[</span><span class="s1">&#39;filter&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">filts</span><span class="p">[</span><span class="n">j</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">t_mod</span><span class="p">,</span> <span class="n">F_mod</span><span class="o">=</span><span class="n">mod</span><span class="p">[</span><span class="s1">&#39;mjd&#39;</span><span class="p">][</span><span class="n">inds</span><span class="p">],</span> <span class="n">mod</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">][</span><span class="n">inds</span><span class="p">]</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_mod</span><span class="p">,</span> <span class="n">F_mod</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colours</span><span class="p">[</span><span class="n">filts</span><span class="p">[</span><span class="n">j</span><span class="p">]])</span>

            <span class="n">l</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">tdelt</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">F_err</span><span class="p">,</span>  <span class="n">marker</span><span class="o">=</span><span class="n">mkr</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>  <span class="n">color</span><span class="o">=</span><span class="n">colours</span><span class="p">[</span><span class="n">filts</span><span class="p">[</span><span class="n">j</span><span class="p">]],</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">tdelt</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">&lt;</span><span class="n">min_x</span><span class="p">:</span>
                <span class="n">min_x</span><span class="o">=</span><span class="n">tdelt</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">tdelt</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">&gt;</span><span class="n">max_x</span><span class="p">:</span>
                <span class="n">max_x</span><span class="o">=</span><span class="n">tdelt</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                

        <span class="n">ext</span><span class="o">=</span><span class="mf">0.05</span><span class="o">*</span><span class="p">(</span><span class="n">max_x</span><span class="o">-</span><span class="n">min_x</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="n">min_x</span><span class="o">-</span><span class="n">ext</span><span class="p">,</span> <span class="n">max_x</span><span class="o">+</span><span class="n">ext</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (days)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Flux&#39;</span><span class="p">)</span>
        <span class="c1">#plt.gca().tick_params(labelsize=8)</span>
        <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Object: </span><span class="si">%s</span><span class="s1">, z:</span><span class="si">%0.2f</span><span class="s1">,  Type:</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">lc</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">],</span> <span class="n">lc</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]))</span>
        <span class="n">labs</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">filts</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">labels</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">labs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">f</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">labs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">labs</span><span class="p">,</span> <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">)</span>
        <span class="c1">#plt.subplots_adjust(left=0.3)</span>
        
    
<div class="viewcode-block" id="Dataset.set_model"><a class="viewcode-back" href="../../API.html#snmachine.sndata.Dataset.set_model">[docs]</a>    <span class="k">def</span> <span class="nf">set_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fit_sn</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Can use any function to set the model for all objects in the data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fit_sn : function</span>
<span class="sd">            A function which can take a light curve (astropy table) argument and a list of arguments and returns an astropy table</span>
<span class="sd">        args : list, optional</span>
<span class="sd">            Whatever arguments fit_sn requires</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Fitting supernova models...&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">object_names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">obj</span><span class="p">]</span><span class="o">=</span><span class="n">fit_sn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">obj</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Models fitted.&#39;</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Dataset.plot_lc"><a class="viewcode-back" href="../../API.html#snmachine.sndata.Dataset.plot_lc">[docs]</a>    <span class="k">def</span> <span class="nf">plot_lc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">plot_model</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Public function to plot a single light curve.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fname : str</span>
<span class="sd">            The filename of the supernova (relative to data_root)</span>
<span class="sd">        plot_model : bool, optional</span>
<span class="sd">            Whether or not to overplot the model</span>
<span class="sd">        title : str, optional</span>
<span class="sd">            Put a title on the plot</span>
<span class="sd">        loc : str, optional</span>
<span class="sd">            Location of the legend</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_model</span><span class="o">=</span><span class="n">plot_model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__plot_this</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">__on_press</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Allows one to cycle through the supernovae in the dataset by hitting the left or right arrow keys.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        event : keyboard event object</span>
<span class="sd">            Keyboard event (i.e. the left or right arrow button has been pressed)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">event</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="o">==</span><span class="s1">&#39;right&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ind</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">object_names</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ind</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="o">==</span><span class="s1">&#39;left&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ind</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ind</span><span class="o">-=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__plot_this</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">object_names</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ind</span><span class="p">])</span>
        <span class="n">event</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
    
<div class="viewcode-block" id="Dataset.plot_all"><a class="viewcode-back" href="../../API.html#snmachine.sndata.Dataset.plot_all">[docs]</a>    <span class="k">def</span> <span class="nf">plot_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plot_model</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots all the supernovae in the dataset and allows the user to cycle through them with the left and</span>
<span class="sd">        right arrow keys.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        plot_model : bool, optional</span>
<span class="sd">            Whether or not to overplot the model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_model</span><span class="o">=</span><span class="n">plot_model</span> <span class="c1">#We use a class variable because this can&#39;t be passed directly to __on_press</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ind</span><span class="o">=-</span><span class="mi">1</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;key_press_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__on_press</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="c1">#subplots_adjust(right=0.95, top=0.95)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>
        
<div class="viewcode-block" id="Dataset.get_types"><a class="viewcode-back" href="../../API.html#snmachine.sndata.Dataset.get_types">[docs]</a>    <span class="k">def</span> <span class="nf">get_types</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of the types of the entire dataset.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        `~numpy.ndarray`</span>
<span class="sd">            Array of types</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">typs</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">object_names</span><span class="p">:</span>
            <span class="n">typs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">o</span><span class="p">]</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])</span>
        <span class="n">tab</span><span class="o">=</span><span class="n">Table</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">object_names</span><span class="p">,</span><span class="n">typs</span><span class="p">],</span><span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Object&#39;</span><span class="p">,</span><span class="s1">&#39;Type&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">tab</span></div>

<div class="viewcode-block" id="Dataset.get_redshift"><a class="viewcode-back" href="../../API.html#snmachine.sndata.Dataset.get_redshift">[docs]</a>    <span class="k">def</span> <span class="nf">get_redshift</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of the redshifts of the entire dataset.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        `~numpy.ndarray`</span>
<span class="sd">            Array of redshifts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">z</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">object_names</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;z&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">o</span><span class="p">]</span><span class="o">.</span><span class="n">meta</span><span class="p">:</span>
                <span class="n">z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">o</span><span class="p">]</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">z</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="Dataset.sim_stats"><a class="viewcode-back" href="../../API.html#snmachine.sndata.Dataset.sim_stats">[docs]</a>    <span class="k">def</span> <span class="nf">sim_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prints information about the survey/simulation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        indices : list-like, optional</span>
<span class="sd">            List of indices to indicate which objects to consider. This allows you to, for example,</span>
<span class="sd">        see the statistics of a training subsample.</span>
<span class="sd">        plot_redshift : bool, optional</span>
<span class="sd">            Plots a histogram of the redshift distribution</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;indices&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">indices</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;indices&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">indices</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">object_names</span><span class="p">))</span>
        <span class="k">if</span> <span class="s1">&#39;plot_redshifts&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">plot_redshifts</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;plot_redshifts&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plot_redshifts</span><span class="o">=</span><span class="kc">True</span>
        
        <span class="n">N</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
        <span class="n">redshifts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
        <span class="n">types</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="n">ind</span><span class="o">=</span><span class="n">indices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">lc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_lightcurve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">object_names</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
            <span class="n">redshifts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">lc</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span>
            <span class="n">types</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">lc</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
            
        <span class="nb">print</span><span class="p">()</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Total number of SNe: </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">()</span>
        <span class="n">ks</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sntypes</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">ks</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ks</span><span class="p">:</span>
            <span class="n">nk</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">types</span><span class="o">==</span><span class="n">k</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Number of </span><span class="si">%s</span><span class="s1">: </span><span class="si">%d</span><span class="s1"> (</span><span class="si">%0.2f%%</span><span class="s1">)&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sntypes</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="n">nk</span> <span class="p">,</span><span class="n">nk</span><span class="o">/</span><span class="n">N</span><span class="o">*</span><span class="mi">100</span><span class="p">))</span>
        <span class="n">nk</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">types</span><span class="o">==-</span><span class="mi">9</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Number of unknown: </span><span class="si">%d</span><span class="s1"> (</span><span class="si">%0.2f%%</span><span class="s1">)&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">nk</span> <span class="p">,</span><span class="n">nk</span><span class="o">/</span><span class="n">N</span><span class="o">*</span><span class="mi">100</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="n">plot_redshifts</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">redshifts</span><span class="p">[</span><span class="n">redshifts</span><span class="o">!=-</span><span class="mi">9</span><span class="p">],</span> <span class="mi">30</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;#0057f6&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Redshift&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="Dataset.reduced_chi_squared"><a class="viewcode-back" href="../../API.html#snmachine.sndata.Dataset.reduced_chi_squared">[docs]</a>    <span class="k">def</span> <span class="nf">reduced_chi_squared</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subset</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the reduced chi squared for each object, once a model has been set.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        subset : str or list-like, optional</span>
<span class="sd">            List of a subset of object names. If not supplied, the full dataset will be used</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            Dictionary of reduced chi^2 for each object</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">subset</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
            <span class="n">data_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">object_names</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data_list</span> <span class="o">=</span> <span class="n">subset</span>
        <span class="n">chi_dict</span> <span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">data_list</span><span class="p">:</span>
            <span class="n">lc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

            <span class="c1">#This selects the filters from the possible set that this object has measurements in and maintains the order</span>
            <span class="n">filts</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filter_set</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">lc</span><span class="p">[</span><span class="s1">&#39;filter&#39;</span><span class="p">])),</span> <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_set</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="n">chi_2</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">N</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># counts total number of points</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">filts</span><span class="p">)):</span>
                <span class="n">inds</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lc</span><span class="p">[</span><span class="s1">&#39;filter&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">filts</span><span class="p">[</span><span class="n">j</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">t</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">F_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lc</span><span class="p">[</span><span class="s1">&#39;mjd&#39;</span><span class="p">][</span><span class="n">inds</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lc</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">][</span><span class="n">inds</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lc</span><span class="p">[</span><span class="s1">&#39;flux_error&#39;</span><span class="p">][</span><span class="n">inds</span><span class="p">])</span>
                <span class="c1">#tdelt=t-t.min()</span>
                <span class="n">tdelt</span><span class="o">=</span><span class="n">t</span>
                <span class="n">N</span> <span class="o">=</span> <span class="n">N</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">tdelt</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">:</span>
                    <span class="n">mod</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">mod</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">inds</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mod</span><span class="p">[</span><span class="s1">&#39;filter&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">filts</span><span class="p">[</span><span class="n">j</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">t_mod</span><span class="p">,</span> <span class="n">F_mod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mod</span><span class="p">[</span><span class="s1">&#39;mjd&#39;</span><span class="p">][</span><span class="n">inds</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mod</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">][</span><span class="n">inds</span><span class="p">])</span>

                        <span class="c1">#interpolate the model so that we can compare the model with the data</span>
                        <span class="n">int_f</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">t_mod</span><span class="p">,</span> <span class="n">F_mod</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>
                        <span class="n">F_mod_mjd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">int_f</span><span class="p">(</span><span class="n">tdelt</span><span class="p">))</span>
                        <span class="n">summand</span><span class="o">=</span><span class="p">(</span><span class="n">F</span><span class="o">-</span><span class="n">F_mod_mjd</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">F_err</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                        <span class="n">chi_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">summand</span><span class="p">)</span> <span class="o">+</span> <span class="n">chi_2</span>

            <span class="n">chi_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">chi_2</span> <span class="o">/</span> <span class="n">N</span>

        <span class="k">return</span> <span class="n">chi_dict</span></div></div>



<div class="viewcode-block" id="OpsimDataset"><a class="viewcode-back" href="../../API.html#snmachine.sndata.OpsimDataset">[docs]</a><span class="k">class</span> <span class="nc">OpsimDataset</span><span class="p">(</span><span class="n">Dataset</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to read in an LSST simulated dataset, based on OpSim runs and SNANA simulations.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">mix</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">filter_set</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lsstu&#39;</span><span class="p">,</span> <span class="s1">&#39;lsstg&#39;</span><span class="p">,</span> <span class="s1">&#39;lsstr&#39;</span><span class="p">,</span> <span class="s1">&#39;lssti&#39;</span><span class="p">,</span> <span class="s1">&#39;lsstz&#39;</span><span class="p">,</span> <span class="s1">&#39;lssty&#39;</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialisation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        folder : str</span>
<span class="sd">            Folder where simulations are located</span>
<span class="sd">        subset : str or list-like, optional</span>
<span class="sd">            List of a subset of object names. If not supplied, the full dataset will be used</span>
<span class="sd">        mix : bool, optional</span>
<span class="sd">            The output of the simulations is often highly ordered, this randomly permutes the objects when they&#39;re read in</span>
<span class="sd">        filter_set : list-like, optional</span>
<span class="sd">            Set of possible filters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">survey_name</span><span class="o">=</span><span class="s1">&#39;LSST&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filter_set</span><span class="o">=</span><span class="n">filter_set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="n">subset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="o">=</span><span class="p">{}</span>
        
        <span class="k">if</span> <span class="n">mix</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
            <span class="n">shuffle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">object_names</span><span class="p">)</span>
            
        
<div class="viewcode-block" id="OpsimDataset.get_data"><a class="viewcode-back" href="../../API.html#snmachine.sndata.OpsimDataset.get_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads in the simulated data</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        folder : str</span>
<span class="sd">            Folder where simulations are located</span>
<span class="sd">        subset : str or list-like, optional</span>
<span class="sd">            List of a subset of object names. If not supplied, the full dataset will be used</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="o">~</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">subset</span><span class="p">,</span><span class="n">basestring</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">basestring</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">subset</span><span class="p">)):</span>
            <span class="c1">#We have to deal with separate Ia and nIa fits files</span>
            <span class="n">Ia_head</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span><span class="s1">&#39;LSST_Ia_HEAD.FITS&#39;</span><span class="p">)</span>
            <span class="n">nIa_head</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span><span class="s1">&#39;LSST_NONIa_HEAD.FITS&#39;</span><span class="p">)</span>

            <span class="n">df</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">Ia_head</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
            <span class="n">subset</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">char</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span> <span class="c1">#If these are read from the header they have to be stripped of white space</span>

            <span class="n">Ia_ids</span><span class="o">=</span><span class="n">subset</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">subset</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">char</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;SNID&#39;</span><span class="p">]))]</span>

            <span class="n">df</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">nIa_head</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
            <span class="n">nIa_ids</span><span class="o">=</span><span class="n">subset</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">subset</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">char</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;SNID&#39;</span><span class="p">]))]</span>

            <span class="n">data_Ia</span> <span class="o">=</span>  <span class="n">sncosmo</span><span class="o">.</span><span class="n">read_snana_fits</span><span class="p">(</span><span class="n">Ia_head</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span><span class="s1">&#39;LSST_Ia_PHOT.FITS&#39;</span><span class="p">),</span><span class="n">snids</span><span class="o">=</span><span class="n">Ia_ids</span><span class="p">)</span>
            <span class="n">data_nIa</span> <span class="o">=</span>  <span class="n">sncosmo</span><span class="o">.</span><span class="n">read_snana_fits</span><span class="p">(</span><span class="n">nIa_head</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span><span class="s1">&#39;LSST_NONIa_PHOT.FITS&#39;</span><span class="p">),</span><span class="n">snids</span><span class="o">=</span><span class="n">nIa_ids</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data_Ia</span> <span class="o">=</span>  <span class="n">sncosmo</span><span class="o">.</span><span class="n">read_snana_fits</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span><span class="s1">&#39;LSST_Ia_HEAD.FITS&#39;</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span><span class="s1">&#39;LSST_Ia_PHOT.FITS&#39;</span><span class="p">))</span>
            <span class="n">data_nIa</span> <span class="o">=</span>  <span class="n">sncosmo</span><span class="o">.</span><span class="n">read_snana_fits</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span><span class="s1">&#39;LSST_NONIa_HEAD.FITS&#39;</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span><span class="s1">&#39;LSST_NONIa_PHOT.FITS&#39;</span><span class="p">))</span>


        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subset</span><span class="p">,</span><span class="n">basestring</span><span class="p">)</span><span class="ow">and</span> <span class="n">subset</span><span class="o">==</span><span class="s1">&#39;Ia&#39;</span><span class="p">:</span>
            <span class="n">all_data</span><span class="o">=</span><span class="n">data_Ia</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subset</span><span class="p">,</span><span class="n">basestring</span><span class="p">)</span> <span class="ow">and</span> <span class="n">subset</span><span class="o">==</span><span class="s1">&#39;nIa&#39;</span><span class="p">:</span>
            <span class="n">all_data</span><span class="o">=</span><span class="n">data_nIa</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">all_data</span><span class="o">=</span><span class="n">data_Ia</span><span class="o">+</span><span class="n">data_nIa</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object_names</span><span class="o">=</span><span class="p">[]</span>
        
        <span class="n">invalid</span><span class="o">=</span><span class="mi">0</span> <span class="c1">#Some objects may have empty data</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Reading data...&#39;</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_data</span><span class="p">)):</span>
            <span class="n">snid</span><span class="o">=</span><span class="n">all_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;SNID&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subset</span><span class="p">,</span><span class="n">basestring</span><span class="p">)</span> <span class="ow">or</span> <span class="p">((</span><span class="n">snid</span> <span class="ow">in</span> <span class="n">subset</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">i</span> <span class="ow">in</span> <span class="n">subset</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">object_names</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">str</span><span class="p">)(</span><span class="n">snid</span><span class="p">))</span>
                <span class="n">lc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_lightcurve</span><span class="p">(</span><span class="n">all_data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lc</span><span class="p">[</span><span class="s1">&#39;mjd&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">snid</span><span class="p">]</span><span class="o">=</span><span class="n">lc</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">invalid</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">invalid</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> objects were invalid and not added to the dataset.&#39;</span> <span class="o">%</span><span class="n">invalid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object_names</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">object_names</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> objects read into memory.&#39;</span> <span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span></div>
        
        
<div class="viewcode-block" id="OpsimDataset.get_lightcurve"><a class="viewcode-back" href="../../API.html#snmachine.sndata.OpsimDataset.get_lightcurve">[docs]</a>    <span class="k">def</span> <span class="nf">get_lightcurve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tab</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts the sncosmo convention for the astropy tables to snmachine&#39;s.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tab : astropy.table.Table</span>
<span class="sd">            Light curve</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tab_new</span><span class="o">=</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;MJD&#39;</span><span class="p">,</span> <span class="s1">&#39;FLUXCAL&#39;</span><span class="p">,</span> <span class="s1">&#39;FLUXCALERR&#39;</span><span class="p">,</span> <span class="s1">&#39;FLT&#39;</span><span class="p">]</span>
        <span class="n">tab_new</span><span class="o">.</span><span class="n">rename_column</span><span class="p">(</span><span class="s1">&#39;MJD&#39;</span><span class="p">,</span><span class="s1">&#39;mjd&#39;</span><span class="p">)</span>
        <span class="n">start_mjd</span><span class="o">=</span><span class="p">(</span><span class="n">tab_new</span><span class="p">[</span><span class="s1">&#39;mjd&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">tab_new</span><span class="p">[</span><span class="s1">&#39;mjd&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">tab_new</span><span class="p">[</span><span class="s1">&#39;mjd&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">start_mjd</span>
        <span class="n">tab_new</span><span class="o">.</span><span class="n">rename_column</span><span class="p">(</span><span class="s1">&#39;FLUXCAL&#39;</span><span class="p">,</span><span class="s1">&#39;flux&#39;</span><span class="p">)</span>
        <span class="n">tab_new</span><span class="o">.</span><span class="n">rename_column</span><span class="p">(</span><span class="s1">&#39;FLUXCALERR&#39;</span><span class="p">,</span><span class="s1">&#39;flux_error&#39;</span><span class="p">)</span>
        <span class="n">tab_new</span><span class="o">.</span><span class="n">rename_column</span><span class="p">(</span><span class="s1">&#39;FLT&#39;</span><span class="p">,</span><span class="s1">&#39;filter&#39;</span><span class="p">)</span>
        <span class="n">tab_new</span><span class="o">=</span><span class="n">Table</span><span class="p">(</span><span class="n">tab_new</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;S64&#39;</span><span class="p">])</span>
        <span class="n">old_filts</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">old_filts</span><span class="p">)):</span>
            <span class="n">tab_new</span><span class="p">[</span><span class="s1">&#39;filter&#39;</span><span class="p">][</span><span class="n">tab_new</span><span class="p">[</span><span class="s1">&#39;filter&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">old_filts</span><span class="p">[</span><span class="n">f</span><span class="p">]]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filter_set</span><span class="p">[</span><span class="n">f</span><span class="p">]</span>
        <span class="n">zp</span><span class="o">=</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;zp&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">27.5</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">tab_new</span><span class="p">[</span><span class="s1">&#39;mjd&#39;</span><span class="p">])))</span>
        <span class="n">zpsys</span><span class="o">=</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;zpsys&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ab&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">tab_new</span><span class="p">[</span><span class="s1">&#39;mjd&#39;</span><span class="p">]))</span>
        <span class="n">tab_new</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="n">zp</span><span class="p">)</span>
        <span class="n">tab_new</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="n">zpsys</span><span class="p">)</span>
        
        <span class="n">tab_new</span><span class="o">.</span><span class="n">meta</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="n">tab</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;SNID&#39;</span><span class="p">],</span> <span class="s1">&#39;z&#39;</span><span class="p">:</span><span class="n">tab</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;REDSHIFT_FINAL&#39;</span><span class="p">],</span> <span class="s1">&#39;z_err&#39;</span><span class="p">:</span><span class="n">tab</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;REDSHIFT_FINAL_ERR&#39;</span><span class="p">],</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="n">tab</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;SNTYPE&#39;</span><span class="p">],</span> 
        <span class="s1">&#39;initial_observation_time&#39;</span><span class="p">:</span><span class="n">start_mjd</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">tab_new</span></div></div>
        

<div class="viewcode-block" id="SDSS_Data"><a class="viewcode-back" href="../../API.html#snmachine.sndata.SDSS_Data">[docs]</a><span class="k">class</span> <span class="nc">SDSS_Data</span><span class="p">(</span><span class="n">Dataset</span><span class="p">):</span>    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to read in the SDSS supernovae dataset</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">training_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">filter_set</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;sdssu&#39;</span><span class="p">,</span><span class="s1">&#39;sdssg&#39;</span><span class="p">,</span> <span class="s1">&#39;sdssr&#39;</span><span class="p">,</span> <span class="s1">&#39;sdssi&#39;</span><span class="p">,</span> <span class="s1">&#39;sdssz&#39;</span><span class="p">],</span> <span class="n">subset_length</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">classification</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialisation</span>
<span class="sd"> </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        folder : str</span>
<span class="sd">            Folder where simulations are located</span>
<span class="sd">        subset : str or list-like, optional</span>
<span class="sd">            List of a subset of object names. If not supplied, the full dataset will be used</span>
<span class="sd">        filter_set : list-like, optional</span>
<span class="sd">            Set of possible filters</span>
<span class="sd">        subset_length : bool or int, optional</span>
<span class="sd">            If supplied, will return this many random objects (can be used in conjunction with subset=&quot;spectro&quot;)</span>
<span class="sd">        classification : str, optional</span>
<span class="sd">            Can return one specific type of supernova.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filter_set</span><span class="o">=</span><span class="n">filter_set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rootdir</span><span class="o">=</span><span class="n">folder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">survey_name</span><span class="o">=</span><span class="n">folder</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="c1"># second to last / / /..</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object_names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_object_names</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">subset</span><span class="p">,</span><span class="n">subset_length</span><span class="o">=</span><span class="n">subset_length</span><span class="p">,</span><span class="n">classification</span><span class="o">=</span><span class="n">classification</span><span class="p">)</span>
        <span class="c1">#Get all the data as a list of astropy tables (this should not be memory intensive, even for large numbers of light curves)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="p">{}</span>
        <span class="n">invalid</span><span class="o">=</span><span class="mi">0</span> <span class="c1">#Some objects may have empty data</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Reading data...&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">object_names</span><span class="p">)):</span>
            <span class="n">lc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_lightcurve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">object_names</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lc</span><span class="p">[</span><span class="s1">&#39;mjd&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">object_names</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">=</span><span class="n">lc</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">invalid</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">invalid</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> objects were invalid and not added to the dataset.&#39;</span> <span class="o">%</span><span class="n">invalid</span><span class="p">)</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> objects read into memory.&#39;</span> <span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
        <span class="c1">#We create an optional model set which can be set by whatever feature class used</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="o">=</span><span class="p">{}</span>

<div class="viewcode-block" id="SDSS_Data.get_SNe"><a class="viewcode-back" href="../../API.html#snmachine.sndata.SDSS_Data.get_SNe">[docs]</a>    <span class="k">def</span> <span class="nf">get_SNe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">subset_length</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to take all supernovae from Master SDSS data file  and return a random sample of SNe of user-specified length</span>
<span class="sd">        if requested</span>
<span class="sd"> </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        subset_length : int</span>
<span class="sd">            Number of objects to return</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list-like</span>
<span class="sd">            List of object names</span>
<span class="sd"> </span>
<span class="sd">        &quot;&quot;&quot;</span>
 
        <span class="n">fl</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rootdir</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">survey_name</span><span class="o">+</span><span class="s1">&#39;.LIST&#39;</span><span class="p">)</span>
        <span class="n">SN</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fl</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;SNIa&quot;</span> <span class="ow">or</span> <span class="n">s</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;SNIb&quot;</span> <span class="ow">or</span> <span class="n">s</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;SNIc&quot;</span> <span class="ow">or</span> <span class="n">s</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;SNII&quot;</span> <span class="ow">or</span> <span class="n">s</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;SNIa?&quot;</span> <span class="ow">or</span> <span class="n">s</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;pSNIa&quot;</span> <span class="ow">or</span> <span class="n">s</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;pSNIbc&quot;</span> <span class="ow">or</span> <span class="n">s</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;pSNII&quot;</span> <span class="ow">or</span> <span class="n">s</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;zSNIa&quot;</span> <span class="ow">or</span> <span class="n">s</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;zSNIbc&quot;</span> <span class="ow">or</span> <span class="n">s</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;zSNII&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">SN</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;SMP_000</span><span class="si">%s</span><span class="s2">.dat&quot;</span> <span class="o">%</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">SN</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;SMP_00</span><span class="si">%s</span><span class="s2">.dat&quot;</span> <span class="o">%</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                    <span class="n">SN</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;SMP_0</span><span class="si">%s</span><span class="s2">.dat&quot;</span> <span class="o">%</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="c1">#SN now contains all file names for supernovae</span>
        <span class="k">if</span> <span class="n">subset_length</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">SN</span> <span class="o">=</span> <span class="p">[</span><span class="n">SN</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">SN</span><span class="p">)),</span> <span class="n">subset_length</span><span class="p">))</span> <span class="p">]</span>

        <span class="k">return</span> <span class="n">SN</span></div>

<div class="viewcode-block" id="SDSS_Data.get_spectro"><a class="viewcode-back" href="../../API.html#snmachine.sndata.SDSS_Data.get_spectro">[docs]</a>    <span class="k">def</span> <span class="nf">get_spectro</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">subset_length</span><span class="p">,</span><span class="n">classification</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to take all spectroscopically confirmed supernovae from Master file and return a random sample of SNe of user-specified length</span>
<span class="sd">        if requested</span>
<span class="sd"> </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        subset_length : bool or int</span>
<span class="sd">            Number of objects to return (False to return all)</span>
<span class="sd">        classification : str</span>
<span class="sd">            Can specify a particular type of supernova to return (&#39;none&#39; for all types)</span>
<span class="sd"> </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list-like</span>
<span class="sd">            List of object names</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fl</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rootdir</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">survey_name</span><span class="o">+</span><span class="s1">&#39;.LIST&#39;</span><span class="p">)</span>
        <span class="n">SN</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">classes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fl</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;SNIa&quot;</span> <span class="ow">or</span> <span class="n">s</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;SNIb&quot;</span> <span class="ow">or</span> <span class="n">s</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;SNIc&quot;</span> <span class="ow">or</span> <span class="n">s</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;SNII&quot;</span><span class="p">):</span>
                <span class="n">classes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">SN</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;SMP_000</span><span class="si">%s</span><span class="s2">.dat&quot;</span> <span class="o">%</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">SN</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;SMP_00</span><span class="si">%s</span><span class="s2">.dat&quot;</span> <span class="o">%</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                    <span class="n">SN</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;SMP_0</span><span class="si">%s</span><span class="s2">.dat&quot;</span> <span class="o">%</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
         <span class="c1">#SN now contains all file names for spectroscopically confirmed supernovae</span>

        <span class="k">if</span> <span class="n">subset_length</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">SN</span><span class="p">)),</span> <span class="n">subset_length</span><span class="p">))</span>
            <span class="n">SN</span> <span class="o">=</span> <span class="p">[</span><span class="n">SN</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span> <span class="p">]</span>
            <span class="n">classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">classes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">classification</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span> <span class="c1"># can specify classification of supernova if user-requested</span>
            <span class="k">if</span> <span class="n">classification</span> <span class="o">==</span> <span class="s1">&#39;Ia&#39;</span> <span class="ow">or</span> <span class="n">classification</span> <span class="o">==</span> <span class="s1">&#39;SNIa&#39;</span><span class="p">:</span>
                <span class="n">SN</span> <span class="o">=</span> <span class="p">[</span><span class="n">SN</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">SN</span><span class="p">))</span> <span class="k">if</span> <span class="n">classes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span><span class="s1">&#39;SNIa&#39;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">classification</span> <span class="o">==</span> <span class="s1">&#39;Ib&#39;</span> <span class="ow">or</span> <span class="n">classification</span> <span class="o">==</span> <span class="s1">&#39;SNIb&#39;</span><span class="p">:</span>
                <span class="n">SN</span> <span class="o">=</span> <span class="p">[</span><span class="n">SN</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">SN</span><span class="p">))</span> <span class="k">if</span> <span class="n">classes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span><span class="s1">&#39;SNIb&#39;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">classification</span> <span class="o">==</span> <span class="s1">&#39;Ic&#39;</span> <span class="ow">or</span> <span class="n">classification</span> <span class="o">==</span> <span class="s1">&#39;SNIc&#39;</span><span class="p">:</span>
                <span class="n">SN</span> <span class="o">=</span> <span class="p">[</span><span class="n">SN</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">SN</span><span class="p">))</span> <span class="k">if</span> <span class="n">classes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span><span class="s1">&#39;SNIc&#39;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">classification</span> <span class="o">==</span> <span class="s1">&#39;Ibc&#39;</span> <span class="ow">or</span> <span class="n">classification</span> <span class="o">==</span> <span class="s1">&#39;SNIbc&#39;</span><span class="p">:</span>
                <span class="n">SN</span> <span class="o">=</span> <span class="p">[</span><span class="n">SN</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">SN</span><span class="p">))</span> <span class="k">if</span> <span class="n">classes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;SNIb&#39;</span> <span class="ow">or</span> <span class="n">classes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;SNIc&#39;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">classification</span> <span class="o">==</span> <span class="s1">&#39;II&#39;</span> <span class="ow">or</span> <span class="n">classification</span> <span class="o">==</span> <span class="s1">&#39;SNII&#39;</span><span class="p">:</span>
                <span class="n">SN</span> <span class="o">=</span> <span class="p">[</span><span class="n">SN</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">SN</span><span class="p">))</span> <span class="k">if</span> <span class="n">classes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;SNII&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Invalid classification requested.&#39;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">SN</span></div>

<div class="viewcode-block" id="SDSS_Data.get_photo"><a class="viewcode-back" href="../../API.html#snmachine.sndata.SDSS_Data.get_photo">[docs]</a>    <span class="k">def</span> <span class="nf">get_photo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">subset_length</span><span class="p">,</span><span class="n">classification</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to take all purely photometric supernovae from Master file and return a   random sample of SNe of user-specified length</span>
<span class="sd">        if requested</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        subset_length : bool or int</span>
<span class="sd">            Number of objects to return (False to return all)</span>
<span class="sd">        classification : str</span>
<span class="sd">            Can specify a particular type of supernova to return (&#39;none&#39; for all types)</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list-like</span>
<span class="sd">            List of object names</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fl</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rootdir</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">survey_name</span><span class="o">+</span><span class="s1">&#39;.LIST&#39;</span><span class="p">)</span>
        <span class="n">SN</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">classes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fl</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;pSNIa&quot;</span> <span class="ow">or</span> <span class="n">s</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;pSNIbc&quot;</span> <span class="ow">or</span> <span class="n">s</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;pSNII&quot;</span> <span class="ow">or</span> <span class="n">s</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;zSNIa&quot;</span> <span class="ow">or</span> <span class="n">s</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;zSNIbc&#39;</span> <span class="ow">or</span> <span class="n">s</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;zSNII&#39;</span> <span class="ow">or</span> <span class="n">s</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;SNIa?&#39;</span><span class="p">):</span>
                <span class="n">classes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">SN</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;SMP_000</span><span class="si">%s</span><span class="s2">.dat&quot;</span> <span class="o">%</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">SN</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;SMP_00</span><span class="si">%s</span><span class="s2">.dat&quot;</span> <span class="o">%</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                    <span class="n">SN</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;SMP_0</span><span class="si">%s</span><span class="s2">.dat&quot;</span> <span class="o">%</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
         <span class="c1">#SN now contains all file names for spectroscopically confirmed supernovae</span>

        <span class="k">if</span> <span class="n">subset_length</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">SN</span><span class="p">)),</span> <span class="n">subset_length</span><span class="p">))</span>
            <span class="n">SN</span> <span class="o">=</span> <span class="p">[</span><span class="n">SN</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span> <span class="p">]</span>
            <span class="n">classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">classes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">classification</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span> <span class="c1"># can specify classification of supernova if user-requested</span>
            <span class="k">if</span> <span class="n">classification</span> <span class="o">==</span><span class="s1">&#39;Ia&#39;</span> <span class="ow">or</span> <span class="n">classification</span> <span class="o">==</span> <span class="s1">&#39;SNIa&#39;</span><span class="p">:</span>
                <span class="n">SN</span> <span class="o">=</span> <span class="p">[</span><span class="n">SN</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">SN</span><span class="p">))</span> <span class="k">if</span> <span class="n">classes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;SNIa?&#39;</span> <span class="ow">or</span> <span class="n">classes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;pSNIa&#39;</span> <span class="ow">or</span> <span class="n">classes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;zSNIa&#39;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">classification</span> <span class="o">==</span> <span class="s1">&#39;Ibc&#39;</span> <span class="ow">or</span> <span class="n">classification</span> <span class="o">==</span> <span class="s1">&#39;SNIbc&#39;</span><span class="p">:</span>
                <span class="n">SN</span> <span class="o">=</span> <span class="p">[</span><span class="n">SN</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">SN</span><span class="p">))</span> <span class="k">if</span> <span class="n">classes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;pSNIbc&#39;</span> <span class="ow">or</span> <span class="n">classes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;zSNIbc&#39;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">classification</span> <span class="o">==</span> <span class="s1">&#39;II&#39;</span> <span class="ow">or</span> <span class="n">classification</span> <span class="o">==</span> <span class="s1">&#39;SNII&#39;</span><span class="p">:</span>
                <span class="n">SN</span> <span class="o">=</span> <span class="p">[</span><span class="n">SN</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">SN</span><span class="p">))</span> <span class="k">if</span> <span class="n">classes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;pSNII&#39;</span> <span class="ow">or</span> <span class="n">classes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;zSNII&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Invalid classification requested.&#39;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">SN</span></div>

<div class="viewcode-block" id="SDSS_Data.get_object_names"><a class="viewcode-back" href="../../API.html#snmachine.sndata.SDSS_Data.get_object_names">[docs]</a>    <span class="k">def</span> <span class="nf">get_object_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">subset_length</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">classification</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets a list of the names of the files within the dataset.</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        subset : str or list-like, optional</span>
<span class="sd">            List of a subset of object names. If not supplied, the full dataset will be used</span>
<span class="sd">        subset_length : bool or int, optional</span>
<span class="sd">            Number of objects to return (False to return all)</span>
<span class="sd">        classification : str, optional</span>
<span class="sd">            Can specify a particular type of supernova to return (&#39;none&#39; for all types)</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list-like</span>
<span class="sd">            Object names</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subset</span><span class="p">,</span><span class="n">basestring</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">subset</span><span class="o">==</span><span class="s1">&#39;spectro&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_spectro</span><span class="p">(</span><span class="n">subset_length</span><span class="p">,</span><span class="n">classification</span><span class="p">))</span> <span class="c1"># have to convert to numpy array for wavelet features to work</span>
                <span class="c1">#loads random sample of the spec confirmed data defaulted to whole</span>
            <span class="k">elif</span> <span class="n">subset</span> <span class="o">==</span> <span class="s1">&#39;photo&#39;</span><span class="p">:</span> <span class="c1">##only photometric data</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_photo</span><span class="p">(</span><span class="n">subset_length</span><span class="p">,</span><span class="n">classification</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">subset</span><span class="o">==</span><span class="s1">&#39;none&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_SNe</span><span class="p">(</span><span class="n">subset_length</span><span class="p">))</span>
                <span class="c1"># loads random sample of SNe from whole master file - sample defaulted to whole</span>
        <span class="k">elif</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">basestring</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">subset</span><span class="p">):</span>
            <span class="c1">#We assume subset is a list of strings containing object names</span>
            <span class="k">return</span> <span class="n">subset</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#Otherwise it must be a list of indices. Otherwise raise an error.</span>
            <span class="n">names</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rootdir</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">survey_name</span><span class="o">+</span><span class="s1">&#39;.LIST&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">names</span><span class="p">[</span><span class="n">subset</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Invalid subset provided&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="SDSS_Data.get_info"><a class="viewcode-back" href="../../API.html#snmachine.sndata.SDSS_Data.get_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">flname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function which takes file name of supernova and returns dictionary of spectroscopic and photometric redshifts and their errors when available as</span>
<span class="sd">           well as the type of the supernova</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        flname : str</span>
<span class="sd">            Name of object</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list-like</span>
<span class="sd">            Redshift, redshift error, type</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fl</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rootdir</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">survey_name</span><span class="o">+</span><span class="s1">&#39;.LIST&#39;</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;z_hel&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">),</span><span class="s1">&#39;z_phot&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">)}</span><span class="c1"># z_hel is spectroscopic heliocentric redshift and z_psnid uses zspec as prior but has many more??</span>
        <span class="n">z_err</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;z_hel_err&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">),</span><span class="s1">&#39;z_phot_err&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">)}</span>
        <span class="n">t</span> <span class="o">=</span> <span class="o">-</span><span class="mi">9</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fl</span><span class="p">:</span>
            <span class="n">s</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="s2">&quot;SMP_000</span><span class="si">%s</span><span class="s2">.dat&quot;</span> <span class="o">%</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">flname</span> <span class="ow">or</span> <span class="s2">&quot;SMP_00</span><span class="si">%s</span><span class="s2">.dat&quot;</span> <span class="o">%</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">flname</span> <span class="ow">or</span> <span class="s2">&quot;SMP_0</span><span class="si">%s</span><span class="s2">.dat&quot;</span> <span class="o">%</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">flname</span><span class="p">:</span> <span class="c1"># is this a bit slow?</span>
                <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="mi">103</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">N&quot;</span><span class="p">:</span>
                    <span class="n">z</span><span class="p">[</span><span class="s1">&#39;z_phot&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">103</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">z</span><span class="p">[</span><span class="s1">&#39;z_phot&#39;</span><span class="p">]</span><span class="o">=</span> <span class="o">-</span><span class="mi">9</span>
                <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">N&quot;</span><span class="p">:</span>
                    <span class="n">z</span><span class="p">[</span><span class="s1">&#39;z_hel&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">11</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">z</span><span class="p">[</span><span class="s1">&#39;z_hel&#39;</span><span class="p">]</span><span class="o">=</span> <span class="o">-</span><span class="mi">9</span>
                <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="mi">104</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">N&quot;</span><span class="p">:</span>
                    <span class="n">z_err</span><span class="p">[</span><span class="s1">&#39;z_phot_err&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">104</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">z_err</span><span class="p">[</span><span class="s1">&#39;z_phot_err&#39;</span><span class="p">]</span><span class="o">=</span> <span class="o">-</span><span class="mi">9</span>
                <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">N&quot;</span><span class="p">:</span>
                    <span class="n">z_err</span><span class="p">[</span><span class="s1">&#39;z_hel_err&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">12</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">z_err</span><span class="p">[</span><span class="s1">&#39;z_hel_err&#39;</span><span class="p">]</span><span class="o">=</span> <span class="o">-</span><span class="mi">9</span>
                <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;SNIa&#39;</span> <span class="ow">or</span> <span class="n">s</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;pSNIa&#39;</span> <span class="ow">or</span> <span class="n">s</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;zSNIa&#39;</span> <span class="ow">or</span> <span class="n">s</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span><span class="s1">&#39;SNIa?&#39;</span><span class="p">:</span> <span class="c1">#all classifications of type Ia SNe - includes probable SNeIa</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">s</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;SNIb&#39;</span> <span class="ow">or</span> <span class="n">s</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;SNIc&#39;</span> <span class="ow">or</span> <span class="n">s</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;pSNIbc&#39;</span> <span class="ow">or</span> <span class="n">s</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;zSNIbc&#39;</span><span class="p">:</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="mi">3</span>
                <span class="k">elif</span> <span class="n">s</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;SNII&#39;</span> <span class="ow">or</span> <span class="n">s</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;pSNII&#39;</span> <span class="ow">or</span> <span class="n">s</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;zSNII&#39;</span><span class="p">:</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">return</span> <span class="n">z</span> <span class="p">,</span> <span class="n">z_err</span><span class="p">,</span> <span class="n">t</span></div>

<div class="viewcode-block" id="SDSS_Data.get_lightcurve"><a class="viewcode-back" href="../../API.html#snmachine.sndata.SDSS_Data.get_lightcurve">[docs]</a>    <span class="k">def</span> <span class="nf">get_lightcurve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a filename, returns a light curve astropy table that conforms with sncosmo requirements</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        flname : str</span>
<span class="sd">            The filename of the supernova (relative to data_root)</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        astropy.table.Table</span>
<span class="sd">            Light curve</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fl</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rootdir</span><span class="o">+</span><span class="n">flname</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">mjd</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">flt</span><span class="o">=</span><span class="p">[]</span> <span class="c1"># band</span>
        <span class="n">flux</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">fluxerr</span><span class="o">=</span><span class="p">[]</span> <span class="c1"># error in flux</span>
        <span class="n">mag</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">magerr</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">line_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fl</span><span class="p">:</span>
            <span class="n">s</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">line_count</span> <span class="o">=</span> <span class="n">line_count</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">line_count</span> <span class="o">&gt;</span> <span class="mi">4</span> <span class="ow">and</span> <span class="nb">float</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">1024</span><span class="p">:</span> <span class="c1"># s[0] is flag - a flag of 1024 or greater indicates bad data ( http://arxiv.org/pdf/0908.4277v1.pdf page 18)</span>
                <span class="n">mjd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">flux</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
                <span class="n">fluxerr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">8</span><span class="p">])</span>
                <span class="n">mag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                <span class="n">magerr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span>
                    <span class="n">flt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;sdssu&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
                    <span class="n">flt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;sdssg&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;2&#39;</span><span class="p">:</span>
                    <span class="n">flt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;sdssr&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;3&#39;</span><span class="p">:</span>
                    <span class="n">flt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;sdssi&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;4&#39;</span><span class="p">:</span>
                    <span class="n">flt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;sdssz&#39;</span><span class="p">)</span>
        <span class="n">mjd</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">mjd</span><span class="p">]</span> <span class="c1"># contains strings - convert to floats</span>
        <span class="n">flux</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">flux</span><span class="p">]</span>
        <span class="n">fluxerr</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fluxerr</span><span class="p">]</span>
        <span class="n">mag</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">mag</span><span class="p">]</span>
        <span class="n">magerr</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">magerr</span><span class="p">]</span>
        <span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">Z_err</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_info</span><span class="p">(</span><span class="n">flname</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Z</span><span class="p">[</span><span class="s1">&#39;z_hel&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">9</span><span class="p">:</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">Z</span><span class="p">[</span><span class="s1">&#39;z_hel&#39;</span><span class="p">]</span> <span class="c1">#use spectroscopic redshifts if available</span>
            <span class="n">z_err</span> <span class="o">=</span> <span class="n">Z_err</span><span class="p">[</span><span class="s1">&#39;z_hel_err&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">Z</span><span class="p">[</span><span class="s1">&#39;z_phot&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">9</span><span class="p">:</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">Z</span><span class="p">[</span><span class="s1">&#39;z_phot&#39;</span><span class="p">]</span> <span class="c1">#photometric redshift</span>
            <span class="n">z_err</span> <span class="o">=</span> <span class="n">Z_err</span><span class="p">[</span><span class="s1">&#39;z_phot_err&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">z</span> <span class="o">=</span> <span class="o">-</span><span class="mi">9</span>
            <span class="n">z_err</span> <span class="o">=</span> <span class="o">-</span><span class="mi">9</span> <span class="c1"># returns values of -9 if no redshift is available</span>

        <span class="c1">#Zeropoint</span>
        <span class="n">zp</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">27.5</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">mjd</span><span class="p">))</span>
        <span class="n">zpsys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ab&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">mjd</span><span class="p">)</span>

        <span class="c1">#Make everything arrays</span>
        <span class="n">mjd</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mjd</span><span class="p">)</span>
        <span class="n">flt</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">flt</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
        <span class="n">flux</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">flux</span><span class="p">)</span>
        <span class="n">fluxerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fluxerr</span><span class="p">)</span>
        <span class="n">mag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mag</span><span class="p">)</span>
        <span class="n">magerr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">magerr</span><span class="p">)</span>
        <span class="n">start_mjd</span><span class="o">=</span><span class="n">mjd</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">r_flux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">flux</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">flux</span><span class="p">))</span> <span class="k">if</span> <span class="n">flt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;sdssr&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">r_flux</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">peak_flux</span> <span class="o">=</span> <span class="n">r_flux</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">peak_flux</span> <span class="o">=</span> <span class="o">-</span><span class="mi">9</span>
        <span class="n">mjd</span><span class="o">=</span><span class="n">mjd</span><span class="o">-</span><span class="n">start_mjd</span> <span class="c1">#We shift the times of the observations to all start at zero. If required, the mjd of the initial observation is stored in the metadata.</span>
        <span class="c1">#Note: obviously this will only zero the observations in one filter band, the others have to be zeroed if fitting functions.</span>
        <span class="n">tab</span> <span class="o">=</span> <span class="n">Table</span><span class="p">([</span><span class="n">mjd</span><span class="p">,</span> <span class="n">flt</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="n">fluxerr</span><span class="p">,</span> <span class="n">zp</span><span class="p">,</span> <span class="n">zpsys</span><span class="p">,</span> <span class="n">mag</span><span class="p">,</span> <span class="n">magerr</span><span class="p">],</span> <span class="n">names</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;mjd&#39;</span><span class="p">,</span> <span class="s1">&#39;filter&#39;</span><span class="p">,</span> <span class="s1">&#39;flux&#39;</span><span class="p">,</span> <span class="s1">&#39;flux_error&#39;</span><span class="p">,</span> <span class="s1">&#39;zp&#39;</span><span class="p">,</span> <span class="s1">&#39;zpsys&#39;</span><span class="p">,</span> <span class="s1">&#39;mag&#39;</span><span class="p">,</span> <span class="s1">&#39;mag_error&#39;</span><span class="p">),</span> <span class="n">meta</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="n">flname</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">:</span><span class="n">z</span><span class="p">,</span> <span class="s1">&#39;z_err&#39;</span><span class="p">:</span><span class="n">z_err</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="nb">type</span><span class="p">,</span> <span class="s1">&#39;initial_observation_time&#39;</span><span class="p">:</span><span class="n">start_mjd</span><span class="p">,</span> <span class="s1">&#39;peak flux&#39;</span><span class="p">:</span><span class="n">peak_flux</span> <span class="p">})</span>

        <span class="k">return</span> <span class="n">tab</span></div></div>
    
<div class="viewcode-block" id="SDSS_Simulations"><a class="viewcode-back" href="../../API.html#snmachine.sndata.SDSS_Simulations">[docs]</a><span class="k">class</span> <span class="nc">SDSS_Simulations</span><span class="p">(</span><span class="n">Dataset</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to read in the SDSS simulations dataset</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">training_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">filter_set</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;sdssu&#39;</span><span class="p">,</span><span class="s1">&#39;sdssg&#39;</span><span class="p">,</span> <span class="s1">&#39;sdssr&#39;</span><span class="p">,</span> <span class="s1">&#39;sdssi&#39;</span><span class="p">,</span> <span class="s1">&#39;sdssz&#39;</span><span class="p">],</span> <span class="n">subset_length</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">classification</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialisation</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        folder : str</span>
<span class="sd">            Folder where simulations are located</span>
<span class="sd">        subset : str or list-like, optional</span>
<span class="sd">            List of a subset of object names. If not supplied, the full dataset will be used</span>
<span class="sd">        filter_set : list-like, optional</span>
<span class="sd">            Set of possible filters</span>
<span class="sd">        subset_length : bool or int, optional</span>

<span class="sd">            If supplied, will return this many random objects (can be used in conjunction with subset=&quot;spectro&quot;)</span>
<span class="sd">        classification : str, optional</span>
<span class="sd">            Can return one specific type of supernova.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filter_set</span><span class="o">=</span><span class="n">filter_set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rootdir</span><span class="o">=</span><span class="n">folder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">survey_name</span><span class="o">=</span><span class="n">folder</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="c1"># second to last / / /..</span>
        <span class="c1">#Get all the data as a list of astropy tables (this should not be memory intensive, even for large numbers of light curves)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="p">{}</span>
        <span class="n">invalid</span><span class="o">=</span><span class="mi">0</span> <span class="c1">#Some objects may have empty data</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Reading data..&#39;</span><span class="p">)</span>
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">invalid</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">subset</span><span class="p">,</span> <span class="n">subset_length</span><span class="p">,</span> <span class="n">classification</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">invalid</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> objects were invalid and not added to the dataset.&#39;</span> <span class="o">%</span><span class="n">invalid</span><span class="p">)</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> objects read into memory.&#39;</span> <span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="c1">#We create an optional model set which can be set by whatever feature class used</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="o">=</span><span class="p">{}</span>


<div class="viewcode-block" id="SDSS_Simulations.get_data"><a class="viewcode-back" href="../../API.html#snmachine.sndata.SDSS_Simulations.get_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">subset_length</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">classification</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to get all data in same form as SDSS Data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># read in data as snana files</span>
        <span class="n">d_Ia</span> <span class="o">=</span> <span class="n">sncosmo</span><span class="o">.</span><span class="n">read_snana_fits</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rootdir</span> <span class="o">+</span> <span class="s2">&quot;SDSS_Ia_HEAD.FITS&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">rootdir</span> <span class="o">+</span> <span class="s2">&quot;SDSS_Ia_PHOT.FITS&quot;</span><span class="p">)</span>
        <span class="n">d_nIa</span> <span class="o">=</span>  <span class="n">sncosmo</span><span class="o">.</span><span class="n">read_snana_fits</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rootdir</span> <span class="o">+</span> <span class="s2">&quot;SDSS_NONIa_HEAD.FITS&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rootdir</span> <span class="o">+</span> <span class="s2">&quot;SDSS_NONIa_PHOT.FITS&quot;</span><span class="p">)</span>
        <span class="n">invalid</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># number of invalid LCs</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># allow user to specify dataset of entirely Ia, Ibc, non-Ia or II</span>
        <span class="k">if</span> <span class="n">classification</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d_Ia</span><span class="p">)):</span>
                <span class="n">SN</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lightcurve</span><span class="p">(</span><span class="n">d_Ia</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">SN</span><span class="p">[</span><span class="s1">&#39;mjd&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">:</span>  
                    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">SN</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;snid&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">SN</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">invalid</span><span class="o">+=</span><span class="mi">1</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d_nIa</span><span class="p">)):</span>
                <span class="n">SN</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lightcurve</span><span class="p">(</span><span class="n">d_nIa</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">SN</span><span class="p">[</span><span class="s1">&#39;mjd&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">SN</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;snid&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">SN</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">invalid</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">elif</span> <span class="n">classification</span> <span class="o">==</span> <span class="s1">&#39;Ia&#39;</span> <span class="ow">or</span> <span class="n">classification</span> <span class="o">==</span> <span class="s1">&#39;SNIa&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d_Ia</span><span class="p">)):</span>
                <span class="n">SN</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lightcurve</span><span class="p">(</span><span class="n">d_Ia</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">SN</span><span class="p">[</span><span class="s1">&#39;mjd&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">:</span>     
                    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">SN</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;snid&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">SN</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">invalid</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">elif</span> <span class="n">classification</span> <span class="o">==</span> <span class="s1">&#39;nIa&#39;</span> <span class="ow">or</span> <span class="n">classification</span> <span class="o">==</span> <span class="s1">&#39;non-SNIa&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d_nIa</span><span class="p">)):</span>
                <span class="n">SN</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lightcurve</span><span class="p">(</span><span class="n">d_nIa</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">SN</span><span class="p">[</span><span class="s1">&#39;mjd&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">SN</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;snid&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">SN</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">invalid</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">elif</span> <span class="n">classification</span> <span class="o">==</span> <span class="s1">&#39;Ibc&#39;</span> <span class="ow">or</span> <span class="n">classification</span> <span class="o">==</span> <span class="s1">&#39;SNIbc&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d_nIa</span><span class="p">)):</span>
                <span class="n">SN</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lightcurve</span><span class="p">(</span><span class="n">d_nIa</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">SN</span><span class="p">[</span><span class="s1">&#39;mjd&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">:</span>  
                    <span class="k">if</span> <span class="n">SN</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">SN</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;snid&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">SN</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">invalid</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">elif</span> <span class="n">classification</span> <span class="o">==</span> <span class="s1">&#39;II&#39;</span> <span class="ow">or</span> <span class="n">classification</span> <span class="o">==</span> <span class="s1">&#39;SNII&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d_nIa</span><span class="p">)):</span>
                <span class="n">SN</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lightcurve</span><span class="p">(</span><span class="n">d_Ia</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">SN</span><span class="p">[</span><span class="s1">&#39;mjd&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">SN</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">SN</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;snid&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">SN</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">invalid</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Invalid classification requested&#39;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
        
        <span class="c1"># allow user to request entirely spectroscopic data or photometric data</span>
        <span class="k">if</span> <span class="n">subset</span> <span class="o">==</span> <span class="s1">&#39;spectro&#39;</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">key</span><span class="p">,</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;data type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;spec&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">subset</span> <span class="o">==</span> <span class="s1">&#39;photo&#39;</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">key</span><span class="p">,</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;data type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;phot&#39;</span><span class="p">)</span>
        
        <span class="c1"># allow user to request a shortened subset of the dataset</span>
        <span class="k">if</span> <span class="n">subset_length</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">sample</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">subset_length</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">invalid</span></div>

<div class="viewcode-block" id="SDSS_Simulations.get_lightcurve"><a class="viewcode-back" href="../../API.html#snmachine.sndata.SDSS_Simulations.get_lightcurve">[docs]</a>    <span class="k">def</span> <span class="nf">get_lightcurve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lc</span><span class="p">):</span>
        
        <span class="n">mjd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">lc</span><span class="p">[</span><span class="s1">&#39;MJD&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lc</span><span class="p">[</span><span class="s1">&#39;MJD&#39;</span><span class="p">]))</span> <span class="k">if</span> <span class="n">lc</span><span class="p">[</span><span class="s1">&#39;FLUXCAL&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">flt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;sdss&#39;</span> <span class="o">+</span> <span class="n">lc</span><span class="p">[</span><span class="s1">&#39;FLT&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lc</span><span class="p">[</span><span class="s1">&#39;FLT&#39;</span><span class="p">]))</span> <span class="k">if</span> <span class="n">lc</span><span class="p">[</span><span class="s1">&#39;FLUXCAL&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">flux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="p">[(</span><span class="n">lc</span><span class="p">[</span><span class="s1">&#39;FLUXCAL&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="o">-</span><span class="mf">1.44</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lc</span><span class="p">[</span><span class="s1">&#39;FLUXCAL&#39;</span><span class="p">]))</span> <span class="k">if</span> <span class="n">lc</span><span class="p">[</span><span class="s1">&#39;FLUXCAL&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">])</span> <span class="c1"># ignore negative flux values</span>
<span class="c1">#FLUX: MULTIPLY BY 10^-1.44 (FLUX IN SDSS IS CALCULATED AS 10^(-0.4MAG +9.56) WHEREAS SIMULATED FLUXES ARE CALCULATED AS 10^(-0.4MAG + 11)- WE USE THE SDSS CONVENTION). </span>
        <span class="n">fluxerr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">lc</span><span class="p">[</span><span class="s1">&#39;FLUXCALERR&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="o">-</span><span class="mf">1.44</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lc</span><span class="p">[</span><span class="s1">&#39;FLUXCALERR&#39;</span><span class="p">]))</span> <span class="k">if</span> <span class="n">lc</span><span class="p">[</span><span class="s1">&#39;FLUXCAL&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">mag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">lc</span><span class="p">[</span><span class="s1">&#39;MAG&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lc</span><span class="p">[</span><span class="s1">&#39;MAGERR&#39;</span><span class="p">]))</span> <span class="k">if</span> <span class="n">lc</span><span class="p">[</span><span class="s1">&#39;FLUXCAL&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">magerr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">lc</span><span class="p">[</span><span class="s1">&#39;MAGERR&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lc</span><span class="p">[</span><span class="s1">&#39;MAGERR&#39;</span><span class="p">]))</span> <span class="k">if</span> <span class="n">lc</span><span class="p">[</span><span class="s1">&#39;FLUXCAL&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">start_mjd</span> <span class="o">=</span> <span class="n">mjd</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">r_flux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">flux</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">flux</span><span class="p">))</span> <span class="k">if</span> <span class="n">flt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;sdssr&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">r_flux</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">peak_flux</span> <span class="o">=</span> <span class="n">r_flux</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">peak_flux</span> <span class="o">=</span> <span class="o">-</span><span class="mi">9</span>
        <span class="n">mjd</span><span class="o">=</span><span class="n">mjd</span><span class="o">-</span><span class="n">start_mjd</span> <span class="c1">#We shift the times of the observations to all start at zero. If required, the mjd of the initial observation is stored in the metadata.</span>
        <span class="c1">#Note: obviously this will only zero the observations in one filter band, the others have to be zeroed if fitting functions.</span>
        <span class="c1"># find supernova classification and whether it is spectroscopically classified or photometrically       </span>
        <span class="n">sntype</span> <span class="o">=</span> <span class="o">-</span><span class="mi">9</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="o">-</span><span class="mi">9</span>
        <span class="k">if</span> <span class="n">lc</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;SNTYPE&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">120</span>  <span class="p">:</span>
            <span class="n">sntype</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;spec&#39;</span>
        <span class="k">elif</span> <span class="n">lc</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;SNTYPE&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">106</span><span class="p">:</span>
            <span class="n">sntype</span> <span class="o">=</span><span class="mi">1</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;phot&#39;</span>
        <span class="k">elif</span> <span class="n">lc</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;SNTYPE&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">32</span> <span class="ow">or</span> <span class="n">lc</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;SNTYPE&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">33</span><span class="p">:</span>
            <span class="n">sntype</span> <span class="o">=</span><span class="mi">3</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;spec&#39;</span>
        <span class="k">elif</span> <span class="n">lc</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;SNTYPE&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">132</span> <span class="ow">or</span> <span class="n">lc</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;SNTYPE&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">133</span><span class="p">:</span>
            <span class="n">sntype</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;phot&#39;</span>
        <span class="k">elif</span> <span class="n">lc</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;SNTYPE&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">22</span><span class="p">:</span>
            <span class="n">sntype</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;spec&#39;</span>
        <span class="k">elif</span> <span class="n">lc</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;SNTYPE&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">122</span><span class="p">:</span>
            <span class="n">sntype</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;phot&#39;</span>
        <span class="c1"># get redshift - heliocentric is used where possible, otherwise a simulated heliocentric redshift is used</span>
        <span class="n">z</span> <span class="o">=</span> <span class="o">-</span><span class="mi">9</span>
        <span class="n">z_err</span> <span class="o">=</span> <span class="o">-</span><span class="mi">9</span>
        <span class="k">if</span> <span class="n">lc</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;REDSHIFT_HELIO&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">9</span> <span class="ow">and</span> <span class="n">lc</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;REDSHIFT_HELIO_ERR&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">9</span><span class="p">:</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">lc</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;REDSHIFT_HELIO&#39;</span><span class="p">]</span>
            <span class="n">z_err</span> <span class="o">=</span> <span class="n">lc</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;REDSHIFT_HELIO_ERR&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">lc</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;SIM_REDSHIFT_HELIO&#39;</span><span class="p">]</span>
            <span class="c1"># no simulated error in redshift available</span>

        <span class="c1">#supernova identifier (used as object name)</span>
        <span class="n">snid</span> <span class="o">=</span> <span class="n">lc</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;SNID&#39;</span><span class="p">]</span>

        <span class="c1">#Zeropoint</span>
        <span class="n">zp</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">27.5</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">mjd</span><span class="p">))</span>
        <span class="n">zpsys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ab&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">mjd</span><span class="p">)</span>
        
        <span class="c1"># form astropy table</span>
        <span class="n">tab</span> <span class="o">=</span> <span class="n">Table</span><span class="p">([</span><span class="n">mjd</span><span class="p">,</span> <span class="n">flt</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="n">fluxerr</span><span class="p">,</span> <span class="n">zp</span><span class="p">,</span> <span class="n">zpsys</span><span class="p">,</span> <span class="n">mag</span><span class="p">,</span> <span class="n">magerr</span><span class="p">],</span> <span class="n">names</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;mjd&#39;</span><span class="p">,</span> <span class="s1">&#39;filter&#39;</span><span class="p">,</span> <span class="s1">&#39;flux&#39;</span><span class="p">,</span> <span class="s1">&#39;flux_error&#39;</span><span class="p">,</span> <span class="s1">&#39;zp&#39;</span><span class="p">,</span> <span class="s1">&#39;zpsys&#39;</span><span class="p">,</span> <span class="s1">&#39;mag&#39;</span><span class="p">,</span> <span class="s1">&#39;mag_error&#39;</span><span class="p">),</span> <span class="n">meta</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;snid&#39;</span><span class="p">:</span> <span class="n">snid</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">:</span><span class="n">z</span><span class="p">,</span> <span class="s1">&#39;z_err&#39;</span><span class="p">:</span><span class="n">z_err</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="n">sntype</span><span class="p">,</span> <span class="s1">&#39;initial_observation_time&#39;</span><span class="p">:</span><span class="n">start_mjd</span><span class="p">,</span> <span class="s1">&#39;peak flux&#39;</span><span class="p">:</span><span class="n">peak_flux</span> <span class="p">,</span> <span class="s1">&#39;data type&#39;</span><span class="p">:</span><span class="n">dtype</span> <span class="p">})</span>

        <span class="k">return</span> <span class="n">tab</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Michelle Lochner, Robert Schuhmann, Jason McEwen, Hiranya Peiris, Rahul Biswas, Ofer Lahav, Johnny Holland, Max Winter.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.0.0',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          
          SphinxRtdTheme.Navigation.enableSticky();
          
      });
  </script> 

</body>
</html>